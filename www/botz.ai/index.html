<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3HMC4TBL9L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3HMC4TBL9L');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>botz.ai - AI News</title>
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="Botz.ai offers the latest news and insights in the world of artificial intelligence. Stay updated with AI trends, breakthroughs, and analysis. Discover how AI is transforming technology and industries worldwide.">
    <meta name="keywords" content="AI news, artificial intelligence, AI trends, AI breakthroughs, AI analysis, machine learning, deep learning, AI technology, AI in business, AI updates, AI research">
  </head>
  <body>
    <h1>AI News</h1>
	<p class="intro">This website and associated microservices were generated by 
    ChatGPT around June 2023 with about 95% of this based on a chat conversation 
    thread over a few hours.  Since then, a number of changes such as dall-e-3 image generation 
    have been made as part of experimenting with various AI apis and tools.  Enjoy :) 
    <a href="https://zoto.io">zoto.io</a>
  </p>
   
    <ul id="article-list"></ul>
    
    <p class="error-message"></p>    
    <script>
      // Fetch the list of articles from the API endpoint
      let currentDate = new Date();
      const articleList = document.querySelector('#article-list');
      window.onhashchange = () => {
        loadArticle()
      }

      // load article based on hash
      function loadArticle() {
        try {
          let hashKey = window.location.hash.slice(1);
          console.log(hashKey);
          document.title = `botz.ai - AI News - ${hashKey}`;
          document.querySelector('.intro').innerHTML = '';
          fetchArticles(hashKey);
        } catch (e) {
          let cacheKey = `${currentDate.getFullYear()}-${padNumber(currentDate.getMonth() + 1)}-${padNumber(currentDate.getDate())}-${padNumber(currentDate.getHours())}`;
          fetchArticles(cacheKey);
          console.log(e);
        }
      }

      function padNumber(number) {
        return number < 10 ? '0' + number : number.toString();
      }

      // initial load
      loadArticle();
      
      function fetchArticles(key) {

        window.scrollTo(0, 0);
        articleList.innerHTML = `<div class="spinner">
          <div class="bounce1"></div>
          <div class="bounce2"></div>
        </div>`;

        fetch(`/editorials?cacheKey=${key}`)

          .then(response => response.json())
          .then(articles => {
          
            articleList.innerHTML = '';

            // Loop through the array of articles and create an <li> element for each one
            articles.forEach(article => {
              const li = document.createElement('li');
              li.innerHTML = `
                ${article.article.image_url ? `<img class="ai-pic" src="${article.article.image_url}" 
                alt="${article.article.authorAlias}" width="400px" style="float:right">
                ` : ``}`;
              li.innerHTML += ` 
              <p>${article.editorial}</p>
              <div class="metadata" style="font-size:14px">
                <p>
                  Original source: ${article.article.source} | ${article.article.published_at}<br>
                  Original title: ${article.article.title}<br>
                  <a href="${article.article.url}">Read Original article</a>
                </p>
                <hr>
              </div>`;
              articleList.appendChild(li);
            });
            articleList.appendChild(document.createElement('hr'));

            const navigation = document.createElement('div');
            navigation.style = "text-align: center";
            // Style for the buttons
            const buttonStyle = "background-color: #4CAF50; color: white; padding: 10px 20px; text-align: center; text-decoration: none; display: inline-block; font-size: 14px; margin: 4px 2px; cursor: pointer; border: none; border-radius: 4px;";

            let nav = '';
            nav += `<button style="${buttonStyle}" onclick="window.location.href='/'">Latest</button>`;
            console.log(articles[0].navigation);
            if (articles[0].navigation.previous) {
                nav += `<button style="${buttonStyle}" onclick="window.location.hash='${articles[0].navigation.previous}'"><< Previous</button>`;
            }
            if (articles[0].navigation.next) {
                nav += `<button style="${buttonStyle}" onclick="window.location.hash='${articles[0].navigation.next}'">Next >></button>`;
            }
            // if (articles[0].navigation.random) {
            //     nav += `<button style="${buttonStyle}" onclick="window.location.hash='${articles[0].navigation.random}'">random</button>`;
            // }
            navigation.innerHTML = nav;

            articleList.appendChild(navigation);
          })
          .catch(error => {
            console.error(error);
            const articleList = document.querySelector('#article-list');
            articleList.innerHTML = '<li>Failed to load articles</li>';
          });
      }  
    </script>
  </body>
</html>
